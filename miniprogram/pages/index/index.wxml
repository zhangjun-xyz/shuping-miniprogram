<!--index.wxml-->
<view class="page-container">
  <!-- 标题区域 -->
  <view class="header">
    <text class="text-title">📚 书评助手</text>
    <text class="text-subtitle">拍照识别书籍，查询豆瓣评分</text>
  </view>

  <!-- 图片预览区域 -->
  <view class="image-preview" wx:if="{{imageUrl}}">
    <image class="book-cover-large" src="{{imageUrl}}" mode="aspectFit"></image>
    <view class="image-actions">
      <button class="btn-secondary" bindtap="clearImage">重新选择</button>
      <button class="btn-primary" bindtap="recognizeBook" disabled="{{isLoading}}">
        {{isLoading ? '识别中...' : '开始识别'}}
      </button>
    </view>
  </view>

  <!-- 操作按钮区域 -->
  <view class="action-buttons" wx:if="{{!imageUrl}}">
    <button class="btn-primary action-btn" bindtap="takePhoto">
      📷 拍照识别
    </button>
    <button class="btn-primary action-btn" bindtap="chooseImage">
      🖼️ 相册选择
    </button>
    <button class="btn-secondary action-btn" bindtap="manualInput">
      ✏️ 手动输入
    </button>
    <button class="btn-test action-btn" bindtap="testConnection">
      🔗 测试连接
    </button>
  </view>

  <!-- 手动输入表单 -->
  <view class="manual-form card" wx:if="{{showManualForm}}">
    <view class="form-title">手动输入书籍信息</view>
    <view class="form-item">
      <text class="form-label">书名 *</text>
      <input class="form-input" placeholder="请输入书名" bindinput="onTitleInput" value="{{bookTitle}}" />
    </view>
    <view class="form-item">
      <text class="form-label">作者</text>
      <input class="form-input" placeholder="请输入作者（可选）" bindinput="onAuthorInput" value="{{bookAuthor}}" />
    </view>
    <view class="form-item">
      <text class="form-label">出版社</text>
      <input class="form-input" placeholder="请输入出版社（可选）" bindinput="onPublisherInput" value="{{bookPublisher}}" />
    </view>
    <view class="form-actions">
      <button class="btn-secondary" bindtap="cancelManualInput">取消</button>
      <button class="btn-primary" bindtap="searchByManualInput" disabled="{{!bookTitle || isLoading}}">
        {{isLoading ? '搜索中...' : '搜索'}}
      </button>
    </view>
  </view>

  <!-- 加载状态 -->
  <view class="loading" wx:if="{{isLoading && !showManualForm}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">{{loadingText}}</text>
  </view>

  <!-- 使用说明 -->
  <view class="instructions card" wx:if="{{!imageUrl && !showManualForm && !isLoading}}">
    <view class="text-subtitle">使用说明</view>
    <view class="instruction-list">
      <view class="instruction-item">📷 拍摄书籍封面，AI自动识别</view>
      <view class="instruction-item">🖼️ 从相册选择书籍图片</view>
      <view class="instruction-item">✏️ 手动输入书籍信息搜索</view>
      <view class="instruction-item">⭐ 查看豆瓣评分和详细信息</view>
    </view>
  </view>
</view>