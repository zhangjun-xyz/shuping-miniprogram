<!--result.wxml-->
<view class="page-container">
  <!-- è¿”å›æŒ‰é’® -->
  <view class="header-actions">
    <button class="btn-secondary back-btn" bindtap="goBack">
      â† è¿”å›
    </button>
  </view>

  <!-- ä¹¦ç±ä¿¡æ¯å¡ç‰‡ -->
  <view class="book-info-card card">
    <view class="book-header">
      <text class="text-title">ğŸ“– ä¹¦ç±ä¿¡æ¯</text>
      <text class="recognition-type">{{recognitionTypeText}}</text>
    </view>

    <view class="book-details">
      <view class="detail-item">
        <text class="detail-label">ä¹¦åï¼š</text>
        <text class="detail-value">{{bookInfo.title || 'æœªè¯†åˆ«'}}</text>
      </view>
      <view class="detail-item">
        <text class="detail-label">ä½œè€…ï¼š</text>
        <text class="detail-value">{{bookInfo.author || 'æœªè¯†åˆ«'}}</text>
      </view>
      <view class="detail-item">
        <text class="detail-label">å‡ºç‰ˆç¤¾ï¼š</text>
        <text class="detail-value">{{bookInfo.publisher || 'æœªè¯†åˆ«'}}</text>
      </view>
    </view>
  </view>

  <!-- è±†ç“£è¯„åˆ†å¡ç‰‡ -->
  <view class="douban-info-card card" wx:if="{{doubanInfo}}">
    <view class="douban-header">
      <text class="text-title">â­ è±†ç“£è¯„åˆ†</text>
    </view>

    <view class="douban-content">
      <!-- è¯„åˆ†ä¿¡æ¯ -->
      <view class="rating-section" wx:if="{{doubanInfo.rating}}">
        <view class="rating-display">
          <text class="rating-score">{{doubanInfo.rating}}</text>
          <text class="rating-total">/10</text>
        </view>
        <view class="rating-stars">
          <text class="star" wx:for="{{stars}}" wx:key="index"
                style="color: {{item ? '#fadb14' : '#d9d9d9'}}">â˜…</text>
        </view>
        <text class="rating-people" wx:if="{{doubanInfo.rating_people}}">
          {{doubanInfo.rating_people}}äººè¯„ä»·
        </text>
      </view>

      <!-- æ— è¯„åˆ†æç¤º -->
      <view class="no-rating" wx:else>
        <text class="no-rating-text">æš‚æ— è¯„åˆ†</text>
        <text class="no-rating-desc">è¿™å¯èƒ½æ˜¯ä¸€æœ¬æ–°ä¹¦</text>
      </view>

      <!-- ä¹¦ç±è¯¦æƒ… -->
      <view class="book-meta">
        <view class="meta-item" wx:if="{{doubanInfo.title}}">
          <text class="meta-label">è±†ç“£ä¹¦åï¼š</text>
          <text class="meta-value">{{doubanInfo.title}}</text>
        </view>
        <view class="meta-item" wx:if="{{doubanInfo.author}}">
          <text class="meta-label">ä½œè€…ï¼š</text>
          <text class="meta-value">{{doubanInfo.author}}</text>
        </view>
        <view class="meta-item" wx:if="{{doubanInfo.publisher}}">
          <text class="meta-label">å‡ºç‰ˆç¤¾ï¼š</text>
          <text class="meta-value">{{doubanInfo.publisher}}</text>
        </view>
        <view class="meta-item" wx:if="{{doubanInfo.publish_year}}">
          <text class="meta-label">å‡ºç‰ˆå¹´ï¼š</text>
          <text class="meta-value">{{doubanInfo.publish_year}}</text>
        </view>
      </view>

      <!-- ç®€ä»‹ -->
      <view class="book-intro" wx:if="{{doubanInfo.intro}}">
        <text class="intro-title">ç®€ä»‹</text>
        <text class="intro-content">{{doubanInfo.intro}}</text>
        <view class="intro-toggle" wx:if="{{doubanInfo.intro.length > 100}}">
          <text class="toggle-btn" bindtap="toggleIntro">
            {{showFullIntro ? 'æ”¶èµ·' : 'å±•å¼€'}}
          </text>
        </view>
      </view>

      <!-- è±†ç“£çŸ­è¯„ -->
      <view class="short-comments" wx:if="{{doubanInfo}}">
        <view class="comments-toggle-section" bindtap="toggleComments">
          <view class="comments-header-content">
            <text class="comments-title">ğŸ’¬ è±†ç“£çŸ­è¯„</text>
            <text class="comments-hint">{{commentsExpanded ? '' : 'ç‚¹å‡»æŸ¥çœ‹ç²¾é€‰çŸ­è¯„'}}</text>
          </view>
          <view class="toggle-icon">{{commentsExpanded ? 'â–²' : 'â–¼'}}</view>
        </view>

        <!-- å±•å¼€åæ˜¾ç¤ºçŸ­è¯„åˆ—è¡¨ -->
        <view class="comments-list" wx:if="{{commentsExpanded}}">
          <!-- åŠ è½½ä¸­ -->
          <view class="comments-loading" wx:if="{{commentsLoading}}">
            <view class="loading-spinner-small"></view>
            <text class="loading-text-small">åŠ è½½ä¸­...</text>
          </view>

          <!-- çŸ­è¯„åˆ—è¡¨ -->
          <view class="comment-item" wx:for="{{comments}}" wx:key="index" wx:if="{{!commentsLoading}}">
            <view class="comment-header">
              <text class="comment-author">{{item.author}}</text>
              <view class="comment-rating" wx:if="{{item.rating}}">
                <text class="star" wx:for="{{item.rating}}" wx:for-item="star" wx:key="star">â˜…</text>
              </view>
            </view>
            <text class="comment-content">{{item.content}}</text>
            <view class="comment-footer">
              <text class="useful-count">ğŸ‘ {{item.useful_count}}äººè§‰å¾—æœ‰ç”¨</text>
            </view>
          </view>

          <!-- æš‚æ— çŸ­è¯„ -->
          <view class="no-comments" wx:if="{{!commentsLoading && comments.length === 0}}">
            <text class="no-comments-text">æš‚æ— çŸ­è¯„</text>
          </view>
        </view>
      </view>

      <!-- è±†ç“£é“¾æ¥ -->
      <view class="douban-link" wx:if="{{doubanInfo.url}}">
        <button class="btn-primary link-btn" bindtap="openDoubanPage">
          åœ¨è±†ç“£ä¸­æŸ¥çœ‹
        </button>
      </view>
    </view>
  </view>

  <!-- æœªæ‰¾åˆ°ç»“æœ -->
  <view class="no-result card" wx:else>
    <view class="no-result-icon">ğŸ˜”</view>
    <text class="no-result-title">æœªæ‰¾åˆ°è±†ç“£ä¿¡æ¯</text>
    <text class="no-result-desc">å¯èƒ½æ˜¯è¯†åˆ«é”™è¯¯æˆ–è¿™æœ¬ä¹¦å°šæœªæ”¶å½•åˆ°è±†ç“£</text>

    <!-- é‡æ–°æœç´¢ -->
    <view class="retry-section">
      <text class="retry-title">æ‰‹åŠ¨æœç´¢</text>
      <input class="retry-input" placeholder="è¯·è¾“å…¥æ­£ç¡®çš„ä¹¦å"
             bindinput="onRetryInput" value="{{retryTitle}}" />
      <button class="btn-primary retry-btn" bindtap="retrySearch"
              disabled="{{!retryTitle || isRetrying}}">
        {{isRetrying ? 'æœç´¢ä¸­...' : 'é‡æ–°æœç´¢'}}
      </button>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <button class="btn-secondary" bindtap="goBack">é‡æ–°è¯†åˆ«</button>
    <button class="btn-primary" bindtap="shareResult" wx:if="{{doubanInfo}}">åˆ†äº«ç»“æœ</button>
  </view>
</view>